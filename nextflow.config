// Enable typed processes
nextflow.preview.types = true

// Set metadata for the pipeline
manifest {
    contributors = [
        [name: "Leon Wang", affiliation: "WEHI: Walter and Eliza Hall Institute of Medical Research", email: "", github: "", orcid: ""],
        [name: "Kathleen Zeglinski", affiliation: "WEHI: Walter and Eliza Hall Institute of Medical Research", email: "", github: "", orcid: ""]
    ]
    description = "Preprocessing of antibody sequences"
    homePage = ""
    mainScript = "main.nf"
    nextflowVersion = ">=25.10.0"
    version = "v1.0.0"
}

// Pipeline parameters
params {
	read_files = "${launchDir}/data/*.fastq"
	phagemid_ref = "${launchDir}/data/reference_files/fab_phagemid.fa"
	matchbox_script = "${launchDir}/matchbox/antibody_preprocess.mb"
	// matchbox_script=/vast/projects/antibody_sequencing/PC008/antibody_preprocess.mb
    help = false
    enable_conda = false
}

// Configure different profiles 
profiles {
    // the "standard" profile is used implicitely by nextflow
    standard {
        process.executor = 'local'
        docker {
            enabled = true
            // this ensures container is run as host user and group, but
            //    also adds host user to the within-container group
            runOptions = "--user \$(id -u):\$(id -g) --group-add 100"
            runOptions= '-v $HOME:$HOME'
        }
    }

    // singularity + slurm profile
    wehi {
        executor {
            name = 'slurm'
            queueSize = 100
            queueStatInterval = '10 sec'
            pollInterval = '10 sec'
            submitRateLimit = '10sec'
        }
        singularity {
            enabled = true
            autoMounts = false
            runOptions = '-B /vast -B /stornext'
        }
    }

    // Conda profile
    conda {
        enabled = false // required for 22.08
        cacheDir = ""
        useMamba = true
        docker.enabled = false
    }

    // local singularity profile
    singularity {
	    process.executor = 'local'
        singularity {
            enabled = true
            autoMounts = false
            runOptions = '-B /vast -B /stornext -B /wehisan'
        }
    }

    // local profile for simplified development testing
    local {
        process.executor = 'local'
    }
}
// The output directory for workflow results
outputDir = "results"